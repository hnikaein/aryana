
\فصل{راه حل}

\قسمت{الگوریتم}
روشی که برای هم‌ردیفی خوانده‌های بایسولفیت در aligner های امروزی مانند Bismark و Brat و Brat-BW رایج است تبدیل تمامی سیتوزین‌های ژنوم مرجع و تمامی سیتوزین‌های خوانده به تیامین و پس از آن هم‌ردیف کردن خوانده‌ها با ژنوم رفرنس با استفاده از bowtie یا روشهای hashing است . مشکلی که در این روش وجود دارد این است که این aligner ها دقت کافی با توجه به اهمیتِ پیدا کردن نقاط متیله شده پیدا نکرده‌اند و در این‌ها برای بالا بردن دقت هم‌ردیفی و پیدا کردن مکان درست متناظر با هر خوانده در ژنوم مرجع ، محدودیت وجود  دارد . مشکلی که در این روشها وجود دارد در این نکته نهفته است که در هم‌ردیف کردن سیتوزین با تیامین چهار حالت ممکن است رخ بدهد:

\شروع{فقرات}
\فقره هم‌ردیفی یک سیتوزین در ژنوم با یک سیتوزین در خوانده 
\فقره هم‌ردیفی یک سیتوزین در ژنوم با یک تیامین در خوانده 
\فقره هم‌ردیفی یک تیامین در ژنوم با یک تیامین در خوانده 
\فقره هم‌ردیفی یک تیامین در ژنوم با یک سیتوزین در خوانده 
\پایان{فقرات}

سه حالت اول برای خوانده‌های بایسولفیت امکان‌پذیر است ؛ اگر سیتوزین خوانده متیله باشد حالت اول پیش می‌آید ، اگر متیله نباشد حالت دوم و حالت سوم نیز هم‌ردیفی T با T است و مشکلی ندارد. حالت آخر در هیچ شرایطی امکان‌پذیر نیست و این هم‌ردیفی قابل قبول نمی‌تواند باشد ولی  باتوجه به اینکه در روش گفته شده تمامی سیتوزین‌ها چه در خوانده و چه در ژنوم به تیامین تبدیل می‌شوند ، حالت چهارم از بقیه حالات قابل تمییز دادن نیست و به عنوان یک هم‌ردیفی قابل قبول در این روش‌ها پذیرفته می‌شود.


\شروع{شکل}[t]
\centerimg{3CT}{7cm}
\شرح{حالات قابل قبول نگاشت C به T}
\برچسب{شکل:حالات قابل قبول}
\پایان{شکل}


تغییرات بایسولفیت و تبدیلات نامتقارن سیتوزین‌ها، فضای جست و جو را به صورت قابل توجهی افزایش می‌دهد. رشته های Watsonو crick  که در واکنش با بایسولفیت تغییر یافته‌اند دیگر مکمل یکدیگر نمی باشند زیرا تغییرات بایسولفیت فقط در سیتوزین‌های غیرمتیله رخ می‌دهد.

نگاشت سیتوزین‌ها به تیامین‌ها به صورت نامتقارن انجام می‌شود. تیامین موجود در readهای بایسولفیت شده هم می تواند به سیتوزین و هم می تواند به تیامین در رفرنس ژنوم نگاشت شود  اما این امر به صورت عکس امکان پذیر نمی‌باشد. این مشکل نه تنها فضای جست و جو را افزایش می‌دهد بلکه پروسه نگاشت را نیز پیچیده تر می نماید. مانند مثالی که در ادامه آورده شده است(شکل 4-2).رشته ATTTCG به سه رشته متفاوت قابل نگاشت است که فضای جست و جو را افزایش داده است( Xi,2009)

تفکر در این موضوع ما را بر این داشت که روشی جدید ارائه کنیم که در آن ناآگاهانه ژنوم و خوانده‌ها را تغییر ندهیم و عوامل زیستی ناحیه‌ای که یک باز در آن قرار گرفته و مشاهداتی که از خواص این نواحی در مورد متیله شدنشان بدست آمده است  ، را در ایجاد تغییرات در ژنوم برای تطابق بیشتر با خوانده‌های بایسولفیت اعمال کنیم .
سیتوزین های CpG context با احتمال ۹۰٪ متیله هستند و سیتوزین های خارج این نواحی در حدود ۱ درصد. به علت اهمیت بالای متیلاسیون این نواحی اهمیت بسیاری پیدا می‌کنند . از طرف دیگر جزایر CpG که نواحی‌ای هستند که  CpGنوکلئوتیدهای آنها چگالی بالایی دارند و سیتوزینهای این CpGها  از قاعده فوق مستثنا هستند و درصد متیلاسیون در این نواحی بسیار پایین است. 
ما در این روش ژنوم‌های مختلفی برای پشتیبانی حالات مختلفی که می‌توان برای سیتوزین‌ها در نظر گرفت ، تولید می‌کنیم . به جای آنکه تمامی سیتوزین‌ها را به تیامین تبدیل کنیم به صورت انتخابی و با توجه به مکانی که آن سیتوزین در آن قرار گرفته است این کار را انجام می‌دهیم ؛ به این صورت که فرض را بر این می‌گذاریم که سیتوزین‌هایی که در نواحی CpG context قرار دارند متیله هستند بنابراین پس از بایسولفیت شدن تغییری نمی‌کنند و سیتوزین‌هایی که در خارج از این نواحی هستند با احتمال خوبی متیله نیستند و پس از بایسولفیت شدن به تیامین تبدیل می‌شوند. همچنین با توجه به اینکه سیتوزینهای درون جزایر CpG با احتمال بیشتری متیله نیستند ، سیتوزین‌هایی که درون نواحی CpG context و جزایر CpG هستند را به همراه سیتوزین‌های بیرون CpG context به تیامین تبدیل کردیم و بقیه بدون تغییر باقی ماندند.
ژنومی که با تغییرات فوق بدست می‌آید برای هم‌ردیفی تمامی خوانده‌های بایسولفیت کافی نیست . علت آن این است که در بدست آوردن خوانده‌ها حتی با روش‌های Next generation sequencing خطا وجود دارد و ممکن است که در خوانده‌ای تیامین به اشتباه سیتوزین گرفته شود (چه فعلی جز خوانده شود؟) و در فرآیند هم‌ردیفی آن خوانده مشکل بوجود آورد . دلیل دیگر این است که در سه حالت فوق ما فرض کردیم که تمامی سیتوزینهای خوانده‌های بیرون CpG context و یا درون جزایر CpG متیله نیستند و تمامی خوانده‌های درون ناحیه و خارج از جزایر متیله‌اند ولی در واقعیت ما این قطعیت را نداریم . برای جبران این تفاوت ما علاوه بر ژنوم فوق ژنوم دیگری تولید می‌کنیم و در آن تمامی سیتوزین‌ها را به تیامین تبدیل می‌نماییم . بدین صورت خوانده‌هایی که با ژنوم قبل نتوانند هم‌ردیف شوند با این ژنوم خواهند شد. برای اینکه هم‌ردیفی با خواص زیستی تطابق بیشتری داشته باشد در انتخاب هم‌ردیفی نهایی به ژنوم قبل اولویت داده می‌شود. 
علاوه بر این دو ژنوم نیاز این دیده می‌شود که برای اینکه خوانده‌های بیشتری را بتوانیم همردیف کنیم ، خوانده‌ها با ژنوم اصلی نیزهمردیف شوند . دلیل آن هم این است که ممکن است نواحی‌ای وجود داشته باشند که سیتوزینها علی‌رغم اینکه CpG نیستند کاملا متیله باشند و ظاهراین نواحی مشابه ژنوم اصلی باشد. دلیل بعدی این موضوع این است که bisulfite treatment روی همه خوانده ها کامل عمل نمی‌کند و ممکن است یک سیتوزین غیر متیله به تیامین تبدیل نشود . برای پوشش دادن این حالات نیز بهتر است که از ژنوم اصلی برای هم‌ردیفی استفاده شود.
علاوه بر ژنوم‌های فوق٬ لازم دیدیم که ژنوم دیگری را نیز در نظر بگیریم که در آن CpG های درون جزیره را مانند دیگر CpG ها متیله در نظر بگیریم. به این دلیل که متیله نبودن CpG ها در جزیره یک رخداد قطعی نیست و این امکان وجود دارد که خوانده‌ای وجود داشته باشد که مطابق انتظار ما نباشد. تلاش ما بر این بود که تا جای ممکن تمامی حالات ممکن برای خوانده‌ها را مدنظر قرار بدهیم. لازم به ذکر است که پس از انجام آزمایش‌های فراوان با خوانده‌های شبیه‌سازی‌شده و واقعی٬ نتیجهٔ لازم را از این ژنوم اضافه را دریافت نکردیم و وجود آن را بی‌مورد احساس کرده و آن را از فرآیند حذف نمودیم. (عکس٬ نمودار٬ هرچی!)
 این نکته قابل توجه است که در aligner های موجود٬ مرسوم است که علاوه بر ژنوم٬ تمامی سیتوزین‌ها در خوانده نیز به تیامین تبدیل شده و سپس هم‌ردیفی انجام می‌شود اما در راه حلی که ما ارائه کرده‌ایم چنین عملی بی‌مورد به نظر می‌رسد. باید توجه داشت که اکثر خوانده‌هایی که هم‌ردیفی ناموفقی با ژنوم ساخته شده در قسمت قبل داشته‌اند٬ خوانده‌هایی هستند که سیتوزین‌های آن‌ها متیله نبوده و به تیامین تبدیل شده‌اند ولی ما در ژنوم ساخته‌شده به اشتباه آن‌ها را سیتوزین نگه داشته‌ایم. در این حالت دیگر نیازی به تغییر در خوانده نیست و باید بدون تغییر به ژنومی که تمامی سیتوزین‌های آن به تیامین تبدیل شده است٬ هم‌ردیف گردد.

******** یکی از موارد بسیار مهم در زمینهٔ هم‌ردیفی خوانده‌های بایسولفیت‌شده٬ توان‌مندی aligner در هم‌ردیفی خوانده‌های PCR شده است. می‌توان نشان داد که در این حالت٬ ژنوم‌های مطرح شده کافی نیستند و خوانده‌های مورد نظر را پوشش نمی‌دهند. همانطور که در شکل زیر پیداست٬ در این نوع٬ خوانده‌ها هم از رشتهٔ مثبت و هم از رشتهٔ منفی جمع‌آوری می‌گردند و در دستگاه PCR تکثیر می‌شوند. سیتوزین‌های غیر متیله در این خوانده‌ها٬ پس از بایسولفیته شدن به تیامین تبدیل می‌شوند. به همین دلیل٬ اگر خوانده‌ای از رشتهٔ منفی برداشته شده باشد٬ پس از بایسولفیته شدن معادل ان خواهد بود که در معکوس این خوانده گوانین‌های غیرمتیله به آدنین تبدیل شده باشند. بدیهی‌ست که این مورد را نمی‌توان با ژنوم‌های پیشتر مطرح‌شده پوشش داد. به همین دلیل ژنوم‌هایی ساخته می‌شود که در آنها در رشتهٔ مثبت٬ گوانین‌ها به آدنین تبدیل می‌گردد. البته ما همچنان خواص زیستی را در این مورد نیز مورد توجه قرار داده‌ایم و برای ساخت این ژنوم مناطق CG و مناطق جزیرهٔ CpG را مد نظر قرار می‌دهیم. (عکس٬ شکل)


\شروع{شکل}[t]
\centerimg{pcr}{7cm}
\شرح{تبدیل $PCR$}
\برچسب{شکل:تبدیل پی‌سی‌آر}
\پایان{شکل}



\قسمت{انتخاب بهترین هم‌ردیفی}

به منظور انتخاب بهترین هم‌ردیفی برای هر خوانده از میان هم‌ردیفی‌هایی مختلفی که می‌تواند با ژنومهای تولید شده داشته باشد ، به محاسبه پنالتی می‌پردازیم . به این صورت که باز به باز خوانده و ژنوم مرجع را در نظر گرفته و بر اساس جایگاه باز و نوع عدم تطابق، یک پنالتی از میان سه پنالتی کم ، متوسط و زیاد که مقادیر آنها ورودی برنامه هستند در نظر می‌گیریم . پنالتی یک خوانده در حال حاضر جمع پنالتی‌های بازهای آن می‌باشد ولی برنامه نوشته شده به این صورت است که قابلیت تغییر تابع محاسبه پنالتی به سادگی وجود دارد و می‌توان مدل آماری مناسب برای این کار را بدست آورد و با کمترین تغییرات ممکن آن را به کد اضافه کرد.
به دلیل اینکه هر خوانده با تمامی ژنومها هم‌ردیف می‌شود ، این نیاز احساس می‌شود که برای مقادیر پنالتی که برای خوانده‌ها بدست می‌آید سقف در نظر بگیریم تا به بهای ...همردیفی ... ، دقت کاهش نیابد. (precision vs specifity)

\قسمت{شبیه‌ساز}

یکی از مراحل حساس و دشوار در تولید یک aligner ٬ مرحله تست و آزمایش و ارزیابی نتایج است. برای این منظور امکان استفاده از خوانده‌های واقعی وجود ندارد به این علت که یک مکان قطعی برای هم‌ردیفی خوانده‌ها بر روی ژنوم وجود ندارد و نمی‌توان نظر قطعی در مورد مکان درست خوانده‌ها بر روی ژنوم داد. به همین منظور ابزارهایی برای شبیه‌سازی و تولید خواندهٔ مصنوعی از روی ژنوم وجود دارد (بهتره اینجا اسم چندتا ابزار مثل سم تولز اینا رو بیاریم).
 ما در ابتدا از این ابزارها برای تولید خوانده‌های مصنوعی استفاده کرده و آزمایش‌های اولیه را انجام دادیم٬ اما پس از پیش‌روی بیشتر٬ نیاز دیدیم که یک شبیه‌ساز تولید کنیم که با دریافت درصدهای متیلیشن٬ خطا و snip خوانده‌های مصنوعی تولید کند و همچنین درصد متیلیشن هر سیتوزین و گوانین را در یک فایل خروجی دهد. مشکلاتی که در دیگر شبیه‌سازها وجود داشت عدم توجه به جزایر CpG و عدم توانایی تولید خوانده‌ به طور خاص از بعضی نواحی ژنوم  بود . امروزه  بخش عمده ای از پژوهشهای DNA Methylation برای کاهش هزینه ، به صورت RRBS انجام می‌شود . به این صورت که درصد بسیاری زیادی از خوانده‌ها از نواحی CpG island (بخشهایی از ژنوم که چگالی CpG contex ها زیاد است)که بخش کوچکی از ژنوم را تشکیل می‌دهند بوسیله افزودن آنزیم‌هایی (مانند Mspl) به دی‌ان‌ای آن را بخش‌بندی می‌کنند و سپس خوانده‌های با تراکم بالا از این قسمتها تولید و تست می‌شوند و شبیه‌سازهای موجود معمولا امکان شبیه‌سازی چنین خوانده‌هایی را فراهم نمی‌کنند.
مشکل دیگر که ذکر شد همان عدم توجه به نواحی از ژنوم که به عنوان جزایر CpG  تلقی می‌شوند است و شبیه‌ساز های موجود به متفاوت بودن درصد متیلاسیون CpG ها در این نواحی نسبت به خارج آنها توجهی ندارند و ما چون نیازمند آن بودیم که با خوانده‌هایی تست کنیم که این موضوع در ساخت آنها درنظر گرفته شده باشد ، شبیه‌ساز متناسب با این نیازمندی‌ها را پیاده‌سازی کردیم.
سپس با استفاده از این شبیه‌ساز انواع مختلف خوانده را تولید کرده و در نهایت با هم‌ردیف کردن آنها و بدست آوردن درصدهای متیلیشن٬ نتایج را با خروجی شبیه‌ساز ، مورد مقایسه قرار دادیم.

\قسمت{محاسبه درصد متیلاسیون}

برای بدست آوردن درصد متیلاسیون هر سیتوزین در samfile نهایی خروجی برنامه فوق ، که البته برای هر گونه فایل خروجی که در آن فرمت sam رعایت شده باشد قابل استفاده است ، برنامه دیگری نوشته شد.
در این برنامه samfile خط به خط خوانده می شود و در ابتدا اگر خوانده‌های samfile , خوانده های pcr هم باشند ، بر اساس flag مشخص کننده strand ای از ژنوم که با آن همردیف شده و تعداد تبدیل‌های آدنین به گوانین و سیتوزین به تیامین مشخص می‌شود که خوانده مربوط به کدام حالت زیر بوده است:

\شروع{فقرات}
\فقره تعداد تبدیلهای A به G بیشتر از C به T و flag همردیفی ۱۶
\فقره تعداد تبدیلهای A به G بیشتر از C به T و flag همردیفی ۰
\فقره تعداد تبدیلهای A به G کمتر از C به T و flag همردیفی ۱۶
\فقره تعداد تبدیلهای A به G کمتر از C به T و flag همردیفی ۰
\فقره تعداد تبدیلهای A به G حدودا برابر با  C به T و flag همردیفی ۰ یا ۱۶
\پایان{فقرات}

flag برابر با ۱۶ نشان‌دهنده این است که خوانده با رشته DNA مربوط به strand منفی همردیف شده است و flag صفر نشاندهنده هم‌ردیفی با strand مثبت . حالت اول و سوم مربوط به خوانده‌های pcr هستند و حالت دوم و چهارم مربوط به خوانده‌های غیر pcr. پس با این شمارش درصورتی که خوانده‌های pcr هم داشته باشیم ، می‌توانیم آنها را تمییز دهیم. مشکلی که باقی می‌ماند حالت پنجم است که در آن ما با یک خوانده مبهم روبرو هستیم که در این حالت هم می‌توان از آنها صرف نظر کرد و هم به صورت رندم یکی از دو حالت ممکن در نظر گرفت .
پس از مشخص شدن نوع خوانده، سیتوزین‌های ژنوم مرجع با مقادیر متناظر در خوانده‌ها مقایسه می‌شوند و اگر در خوانده C دیده شود به تعداد خوانده هایی که در آنها C متیله بوده است و آن جایگاه در ژنوم را پوشش می‌دهند یک واحد اضافه می‌شود و اگر T دیده شود یک واحد به تعداد Cهای غیر متیله اضافه می‌شود. در واقع پس از پایان این فرآیند برای تمامی خطوط samfile اطلاعاتی که ما به ازای هر سیتوزین در ژنوم مرجع خواهیم داشت عبارتند از:

\شروع{فقرات}
\فقره جایگاه سیتوزین نسبت به ابتدای کروموزوم
\فقره strandای که خوانده با آن همردیف شده است 
\فقره تعداد خوانده هایی که این سیتوزین را پوشش داده و در آنها این C ، C بوده است.(تعداد خوانده های متیله)
\فقره تعداد خوانده هایی که این سیتوزین را پوشش داده و در آنها این C ،  Tبوده است.(تعداد خوانده های غیرمتیله)
\پایان{فقرات}
و با داشتن این مقادیر ، درصد متیلاسیون هر سیتوزین به صورت strand-specific بدست می‌آید.

\فصل{پیاده‌سازی}

در اولین گام پیاده‌سازی لازم است که ژنوم‌های مورد نیاز (که در بخش solution مطرح گردید) از روی ژنوم اصلی ساخته شوند. از آنجایی که معمولا اندازهٔ ژنوم‌ها بسیار بزرگ است٬ این مرحله زمان زیادی می‌برد. لازم به ذکر است که این گام یک پیش‌پردازش است و برای هر ژنوم این مرحله تنها یک بار انجام می‌شود و پس از آن برای اجرای انواع alignment از همین ژنوم‌ها استفاده می‌شود. این بخش از برنامه به زبان C++ نوشته شده است.
در گام بعدی٬ پارامترهایی به برنامهٔ آریانا اضافه گردید تا میان اجرای هم‌ردیفی در حالت بایسولفیت و غیر بایسولفیت تفاوت قائل شود. در حالتی که اجرای بایسولفیت مد نظر باشد٬ آریانا به ازای هر ژنومِ ساخته شده یک مرتبه هم‌ردیفی انجام می‌دهد. نکتهٔ قابل توجه آن است که برنامهٔ آریانا به گونه‌ای تغییر داده شده است که پیش‌پردازش‌ها و پس‌پردازش‌های مشترک میان هم‌ردیفی‌ها تنها یک بار صورت گیرد که هزینهٔ کمتری پرداخت شود. خروجی این مرحله ۵ سم‌فایل است که حاصل ۵ بار هم‌ردیفی است.
در گام آخر باید از میاد هم‌ردیفی‌های صورت گرفته (۵ سم‌فایل) بهترین را انتخاب کنیم. بدیهی‌ترین روش برای انجام این مورد آن است که به ازای هر خوانده٬ تمامی سم‌فایل‌ها را بررسی کرده و بهترین هم‌ردیفی را انتخاب کنیم. واضح است که انجام این عمل به خودی خود امکان‌پذیر نیست٬ چرا که نمی‌توان ۵ فایل با ابعاد بسیار بزرگ را در حافظه نگه داشت و همچنین نمی‌توان به ازای هر خوانده تمامی فایل‌ها را یک بار جستجو کرد. به همین منظور در ابتدا سم‌فایل‌ها را بر اساس نام خوانده‌ها٬ توسط linux command مناسب مرتب می‌کنیم. سپس هر سطر از هر ۵ سم‌فایل را می‌خوانیم و از میان آن‌ها بهترین هم‌ردیفی را انتخاب کرده و نتیجه را مستقیما در خروجی چاپ می‌کنیم. در این حالت در هر لحظه تنها ۵ خوانده در حافظه وجود دارند و مشکل حافظه برطرف می‌گردد. قابل توجه است که آریانا٬ علی‌رغم دیگر aligner ها٬ به ازای خوانده‌های ناموفق در هم‌ردیفی نیز سطری در سم‌فایل نهایی قرار می‌دهد. به همین دلیل٬ ترتیب خوانده‌ها پس از مرتب‌سازی در تمامی ۵ فایل یکسان است.

\قسمت{تابع پنالتی}

تشخیص نواحی CpG context بر این اساس بود که هر سیتوزین در forward strand چک می‌شود که آیا بعد آن گوانین آمده است یا خیر و اگر آمده باشد یک ناحیه در نظر گرفته می‌شود. مکانهای جزایر CpG که تعداد آنها برای ژنوم انسان از O() را در حافظه به صورت مرتب‌شده نگه می‌داریم و برای چک کردن اینکه یک سیتوزین در جزیره CpG قرار دارد یا نه بر روی داده ساختاری که مکان شروع و پایان جزایر را نگه داشته‌ شده ، جستجوی دودویی صورت می‌پذیرد.
در تابع فعلی برای محاسبه پنالتی بازها ، اگر باز در خوانده و ژنوم هر دو C باشد و بعد از آن G آمده باشد و جزیره CpG پنالتی متوسط می‌دهیم چون معمولا سیتوزین‌های درون جزایر غیر متیله اند و در خارج جزیره پنالتی کم اختصاص می‌یابد (به این دلیل که در این حالت انتظار می‌رود خوانده متیله باشد پس سیتوزین ، بعد از بایسولفیت سیتوزین باقی می‌ماند) و در خارج CpG context پنالتی زیاد اختصاص می‌یابد(به این دلیل که در این حالت انتظار می‌رود خوانده متیله نباشد).
اگر باز در خوانده T باشد و مقدار متناظر در ژنوم C باشد در حالت اول پنالتی صفر داریم ، در حالت دوم پنالتی کم اختصاص داده می‌شود(به این دلیل که در این حالت انتظار می‌رود خوانده متیله باشد پس سیتوزین ، بعد از بایسولفیت باید سیتوزین باقی بماند) و در خارج CpG context پنالتی کم اختصاص می‌یابد(به این دلیل که در این حالت انتظار می‌رود خوانده متیله نباشد).
برای حالات درج و حذف نیز بیشترین پنالتی ممکن در نظر گرفته می‌شود چون درج و حذف به وضوح حالت نامطلوبی برای ما به حساب می‌آید و لازم است که بین این حالات و حالت تطابق تفاوت محسوسی قائل شویم.
به طور کلی خوانده‌ها به صورت ترتیبی از فایل خوانده می‌شوند و بر اساس رشته سیگار آنها مشخص می‌شود که کدام بازهای آنها با حذف و اضافه و کدام بازها با تطبیق یا عدم تطبیق هم‌ردیف شده‌اند و سپس به روش توضیح داده شده پنالتی‌ کلی یک خوانده محاسبه می‌شود.

\قسمت{محاسبه درصد متیلاسیون}

به دلیل ابعاد بزرگ مساله و محدودیت حافظه ای که وجود دارد خوانده‌های همردیف شده را خط به خط از فایل ورودی گرفته و در یک بافر حلقوی به سایز طول بزرگترین خوانده ، جایگاه سیتوزین‌ها به همراه مقادیر توضیح داده شده نگه داشته می‌شوند و در صورت رسیدن به انتهای یک خوانده بافر به اندازه اختلاف جایگاه شروع خوانده بعدی با شروع خوانده فعلی خالی می‌شود. برای map سیتوزینهای ژنوم به بافر از یک تابع hash خطی ساده استفاده می‌شود.